(function(window) {
  var MozillaTaiwan = [
    {
      name: 'Alive',
      email: 'alive@mozilla.com',
      team: 'gaia',
      functional: 'free'
    },
    {
      name: 'Yuren',
      email: 'yurenju.mozilla@gmail.com',
      team: 'gaia',
      functional: 'system-platform'
    },
    {
      name: 'Arthur',
      email: 'arthur.chen@mozilla.com',
      team: 'gaia',
      functional: 'system-platform'
    },
    {
      name: 'Gary',
      email: 'gchen@mozilla.com',
      team: 'gaia',
      functional: 'system-platform'
    },
    {
      name: 'John',
      email: 'johu@mozilla.com',
      team: 'gaia',
      functional: 'media'
    },
    {
      name: 'Dominic',
      email: 'dkuo@mozilla.com',
      team: 'gaia',
      functional: 'media'
    },
    {
      name: 'Dietrich',
      email: 'dietrich@mozilla.com',
      team: 'pm',
      functional: 'media'
    },
    {
      name: 'Patryk',
      email: 'padamczyk@mozilla.com',
      team: 'ux',
      functional: 'media'
    },
    {
      name: 'FxOS UX',
      email: 'firefoxos-ux-bugzilla@mozilla.com',
      team: 'ux',
      functional: ''
    },
    {
      name: 'Dave',
      email: 'dhylands@mozilla.com',
      team: 'gaia',
      functional: ''
    },
    {
      name: 'Mike H',
      email: 'mhabicher@mozilla.com',
      team: 'gaia',
      functional: ''
    },
    {
      name: 'David F',
      email: 'dflanagan@mozilla.com',
      team: 'gaia',
      functional: 'media',
      tags: ['god']
    },
    {
      name: 'James P',
      email: 'squibblyflabbetydoo@gmail.com',
      team: 'gaia',
      functional: 'media'
    },
    {
      name: 'Sotaro',
      email: 'sotaro.ikeda.g@gmail.com',
      team: 'gecko',
      functional: 'media'
    },
    {
      name: 'George',
      email: 'gduan@mozilla.com',
      team: 'gaia',
      functional: 'system-platform'
    },
    {
      name: 'Ian',
      email: 'iliu@mozilla.com',
      team: 'gaia',
      functional: 'productivity'
    },
    {
      name: 'Adam Rogers',
      email: 'arogers@mozilla.com',
      team: 'pm',
      functional: 'productivity'
    },
    {
      name: 'Candice',
      email: 'cserran@mozilla.com',
      team: 'pm',
      functional: ['system-frontend', 'productivity', 'browser']
    },
    {
      name: 'Naoki',
      email: 'nhirata.bugzilla@gmail.com',
      team: 'qa',
      functional: ['browser']
    },
    {
      name: 'Ben Francis',
      email: 'bfrancis@mozilla.com',
      team: 'gaia',
      functional: ['browser']
    },
    {
      name: 'Dale',
      email: 'dale@arandomurl.com',
      team: 'gaia',
      functional: ['browser']
    },
    {
      name: 'Rob Macdonald',
      email: 'rmacdonald@mozilla.com',
      team: 'ux',
      functional: ['productivity', 'media']
    },
    {
      name: 'Przemek',
      email: 'pabratowski@mozilla.com',
      team: 'pm',
      functional: 'productivity'
    },
    {
      name: 'Dylan Oliver',
      email: 'doliver@mozilla.com',
      team: 'pm',
      functional: 'productivity'
    },
    {
      name: 'James Lal',
      email: 'jlal@mozilla.com',
      team: 'gaia',
      functional: 'productivity'
    },
    {
      name: 'Andrew S',
      email: 'bugmail@asutherland.org',
      team: 'gaia',
      functional: 'productivity'
    },
    {
      name: 'Gareth A',
      email: 'gaye@mozilla.com',
      team: 'gaia',
      functional: 'productivity'
    },
    {
      name: 'James Burke',
      email: 'jrburke@gmail.com',
      team: 'gaia',
      functional: 'productivity'
    },
    {
      name: 'Marcus',
      email: 'mcav@mozilla.com',
      team: 'gaia',
      functional: 'productivity'
    },
    {
      name: 'Steve',
      email: 'schung@mozilla.com',
      team: 'gaia',
      functional: 'communications'
    },
    {
      name: 'Rex',
      email: 'rexboy@mozilla.com',
      team: 'gaia',
      functional: 'communications'
    },
    {
      name: 'Etienne',
      email: 'etienne@segonzac.info',
      team: 'gaia',
      functional: 'communications'
    },
    {
      name: 'Julien',
      email: 'felash@gmail.com',
      team: 'gaia',
      functional: ['communications']
    },
    {
      name: 'Anthony',
      email: 'anthony@ricaud.me',
      team: 'gaia',
      functional: ['communications']
    },
    {
      name: 'Michal B',
      email: 'mbudzynski@mozilla.com',
      team: 'gaia',
      functional: ['communications']
    },
    {
      name: 'Gabriel S',
      email: 'gsvelto@mozilla.com',
      team: 'gaia',
      functional: ['communications']
    },
    {
      name: 'Gregor W',
      email: 'anygregor@gmail.com',
      team: 'gecko',
      functional: ['system-frontend']
    },
    {
      name: 'Kyle M',
      email: 'kyle@nonpolynomial.com',
      team: 'gecko',
      functional: ['system-frontend']
    },
    {
      name: 'Reuben M',
      email: 'reuben.bmo@gmail.com',
      team: 'gecko',
      functional: ['system-frontend']
    },
    {
      name: 'Evan',
      email: 'evanxd@mozilla.com',
      team: 'gaia',
      functional: 'productivity'
    },
    {
      name: 'Rudy',
      email: 'rlu@mozilla.com',
      team: 'gaia',
      functional: 'system-platform'
    },
    {
      name: 'Fred',
      email: 'gasolin@mozilla.com',
      team: 'gaia',
      functional: 'system-platform'
    },
    {
      name: 'EJ',
      email: 'ejchen@mozilla.com',
      team: 'gaia',
      functional: ''
    },
    {
      name: 'Luke',
      email: 'lchang@mozilla.com',
      team: 'gaia',
      functional: ''
    },
    {
      name: 'Tzu-Lin',
      email: 'tzhuang@mozilla.com',
      team: 'gaia',
      functional: ''
    },
    {
      name: 'Greg',
      email: 'gweng@mozilla.com',
      team: 'gaia',
      functional: 'system-platform'
    },
    {
      name: 'Kanru',
      email: 'kchen@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Henry',
      email: 'hchang@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Vincent Chang',
      email: 'vchang@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Edgar',
      email: 'echen@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Aknow',
      email: 'szchen@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Yoshi',
      email: 'allstars.chh@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Jessica',
      email: 'jjong@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Dimi',
      email: 'dlee@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Thomas Z',
      email: 'tzimmermann@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Shao-Hang',
      email: 'skao@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Chuck',
      email: 'chulee@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Gene',
      email: 'gene.lian@mozilla.com',
      team: 'gecko',
      functional: ['communications']
    },
    {
      name: 'John(Stone)',
      email: 'jshih@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Hsinyi',
      email: 'htsai@mozilla.com',
      team: 'gecko',
      functional: ['communications']
    },
    {
      name: 'ChiaHung',
      email: 'ctai@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    /* {
      name: 'Bevis',
      email: 'btseng@mozilla.com'
    }, */
    {
      name: 'Georgia',
      email: 'gwang@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Patrick',
      email: 'pwang@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    {
      name: 'Vicamo',
      email: 'vyang@mozilla.com',
      team: 'gecko',
      functional: 'telephony'
    },
    {
      name: 'Phoebe',
      email: 'phchang@mozilla.com',
      team: 'gecko',
      functional: 'recording'
    },
    {
      name: 'Peter',
      email: 'pchang@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Benjamin',
      email: 'bechen@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    {
      name: 'SC',
      email: 'schien@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    {
      name: 'Steven',
      email: 'slee@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    /*{
      name: 'John Lin',
      email: 'jolin@mozilla.com',
      team: 'gecko',
      functional: ''
    },*/
    {
      name: 'Randy',
      email: 'rlin@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    {
      name: 'Shelly',
      email: 'slin@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    {
      name: 'Jerry',
      email: 'hshih@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Morris',
      email: 'mtseng@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'JW',
      email: 'jwwang@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    {
      name: 'Alfredo',
      email: 'ayang@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    {
      name: 'Marco',
      email: 'mchen@mozilla.com',
      team: 'gecko',
      functional: ['device']
    },
    {
      name: 'Eric',
      email: 'echou@mozilla.com',
      team: 'gecko',
      functional: ['telephony', 'bluetooth']
    },
    {
      name: 'Gina',
      email: 'gyeh@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Ben',
      email: 'btian@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Bruce',
      email: 'brsun@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Alan',
      email: 'ahuang@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Shawn',
      email: 'shuang@mozilla.com',
      team: 'gecko',
      functional: ['telephony']
    },
    {
      name: 'Shawn Ku',
      email: 'sku@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Vincent Lin',
      email: 'vlin@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Vincent Liu',
      email: 'vliu@mozilla.com',
      team: 'gecko',
      functional: ['device']
    },
    {
      name: 'Viral',
      email: 'vwang@mozilla.com',
      team: 'gecko',
      functional: ['device']
    },
    {
      name: 'TingYuan',
      email: 'thuang@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Thinker',
      email: 'tlee@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Cervantes',
      email: 'cyu@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'Ken',
      email: 'kchang@mozilla.com',
      team: 'gecko',
      functional: ['nfc']
    },
    {
      name: 'Ethan',
      email: 'ettseng@mozilla.com',
      team: 'gecko',
      functional: ''
    },
    {
      name: 'CJ',
      email: 'cku@mozilla.com',
      team: 'gecko',
      functional: ['recording']
    },
    {
      name: 'Tim',
      email: 'timdream@gmail.com',
      team: 'gaia:platform',
      functional: 'system-platform'
    },
    {
      name: 'Evelyn',
      email: 'ehung@mozilla.com',
      team: 'gaia:device',
      functional: ''
    },
    {
      name: 'Mike',
      email: 'mtsai@mozilla.com',
      team: 'ux',
      functional: ''
    },
    {
      name: 'Pecko',
      email: 'pchen@mozilla.com',
      team: 'ux',
      functional: ''
    },
    {
      name: 'Neo',
      email: 'nhsieh@mozilla.com',
      team: 'ux',
      functional: ''
    },
    {
      name: 'Helen',
      email: 'hhuang@mozilla.com',
      team: 'ux',
      functional: ''
    },
    {
      name: 'Juwei',
      email: 'jhuang@mozilla.com',
      team: 'ux',
      functional: ''
    },
    {
      name: 'Fang',
      email: 'fshih@mozilla.com',
      team: 'ux',
      functional: ''
    },
    {
      name: 'Carrie',
      email: 'cawang@mozilla.com',
      team: 'ux',
      functional: ''
    },
    {
      name: 'William',
      email: 'whsu@mozilla.com',
      team: 'qa',
      functional: ['recording', 'productivity']
    },
    {
      name: 'Atsai',
      email: 'atsai@mozilla.com',
      team: 'qa',
      functional: ['performance']
    },
    {
      name: 'Kevin Grandon',
      email: 'kgrandon@mozilla.com',
      team: 'gaia',
      functional: ['performance']
    },
    {
      name: 'Chris',
      email: 'clee@mozilla.com',
      team: 'pm',
      functional: ['browser']
    },
    {
      name: 'Walter',
      email: 'wachen@mozilla.com',
      team: 'qa',
      functional: ['telephony']
    },
    {
      name: 'Askeing',
      email: 'fyen@mozilla.com',
      team: 'qa',
      functional: ['system-platform']
    },
    {
      name: 'Paul Theriault',
      email: 'ptheriault@mozilla.com',
      team: 'gecko',
      functional: ['system-platform']
    },
    {
      name: 'Enpei',
      email: 'echu@mozilla.com',
      team: 'qa',
      functional: ''
    },
    {
      name: 'Joe',
      email: 'jcheng@mozilla.com',
      team: 'pm',
      functional: ['communications', 'recording', 'device']
    },
    {
      name: 'Wayne',
      email: 'wchang@mozilla.com',
      team: 'pm',
      functional: ''
    },
    {
      name: 'Kevin Hu',
      email: 'khu@mozilla.com',
      team: 'pm',
      functional: ['telephony', 'bluetooth']
    },
    {
      name: 'Ivan',
      email: 'itsay@mozilla.com',
      team: 'pm',
      functional: ['system-platform']
    },
    {
      name: 'Bruce Huang',
      email: 'bhuang@mozilla.com',
      team: 'pm',
      functional: ''
    },
    {
      name: 'Steven Yang',
      email: 'styang@mozilla.com',
      team: 'pm',
      functional: ''
    },
    {
      name: 'Francis Lee ',
      email: 'frlee@mozilla.com',
      team: 'pm',
      functional: ['nfc']
    }
  ];

  var App = {
    config: {
      start: '2013-07-15',
      end: moment().format('YYYY-MM-DD')
    },

    init: function app_init() {
      this._bindEvents();
      MozillaTaiwan.forEach(function(person) {
        new BZQuery(jQuery.extend({
          start: this.config.start,
          end: this.config.end
        }, person));
      }, this);

      this.parseURL();
    },

    filter: function(filter, type) {
      BZQuery.manager.sort(function(a, b) {
        if (a.visibilityState == 'background' &&
            b.visibilityState == 'foreground') {
          return -1;
        } else {
          return 1;
        }
      });
      BZQuery.manager.forEach(function(person) {
        person.filter(filter, type);
      });
    },

    _bindEvents: function app__bindEvents() {
      var self = this;
      /* hash change */
      window.onhashchange = function() {
        var type = '';
        switch (location.hash) {
          case '#':
          case '':
            break;
          default:
            self.parseURL();
          break;
        }
      };

      /* Date Picker */
      $('#dp').datepicker({
         format: "yyyy-mm-dd",
         autoclose: true
      }).on('changeDate', function(evt){
        if (evt.target.name == 'start') {
          self.config.start = evt.format('yyyy-mm-dd');
        } else if (evt.target.name == 'end') {
          self.config.end = evt.format('yyyy-mm-dd');
        }

        BZQuery.manager.sort(function(a, b) {
          if (a.visibilityState == 'background' &&
              b.visibilityState == 'foreground') {
            return -1;
          } else {
            return 1;
          }
        });

        BZQuery.manager.forEach(function(person) {
          person.reload(self.config);
        });
      });

      /* Tab */
      this.tab = $('#brh-tab').tab();
      $('#brh-tab a').click(function (evt) {
        var team = $(this).prop('href').split('#')[1];
        var type = $(this).data('type');
        evt.preventDefault();
        $(this).tab('show');
        if (type) {
          window.location.hash = '#' + team + ':' + type;
        } else {
          window.location.hash = '#' + team;
        }
      });
    },

    parseURL: function app_parseURL() {
      if (location.hash) {
        var s = location.hash.split(':');
        var type = s.length > 1 ? 
                    s[1] : '';

        this.tab.find('[href="' + s[0] + '"]').tab('show');
        var filter = s[0].replace('#', '');
        this.filter(filter, type);
      } else {
      }
    }
  };

  App.init();

}(this));